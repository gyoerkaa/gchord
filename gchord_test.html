<html>
    <head>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="gchord.js"></script>
        <script type="text/javascript">
            google.load("visualization", "1");

            // Set callback to run when API is loaded
            google.setOnLoadCallback(drawVisualization);

            // Called when the Chart API is loaded.
            function drawVisualization() {
                // Create and populate a data table.
                
                // https://docs.google.com/spreadsheet/ccc?key=0Aj7HUoKktLr_dC1hQk44S0tGNVNXQjJiNXFiNmhaVlE&usp=sharing
                /*
                var query = new google.visualization.Query(
                'http://spreadsheets.google.com/tq?key=pCQbetd-CptGXxxQIG7VFIQ&range=B1:D11&pub=1');
                // Send the query with a callback function.
                query.send(handleQueryResponse);
                */
                
                // Construct a table ourselves
                // # target id # weight # source id # source name # 
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Target ID',   'target_id');               
                data.addColumn('number', 'Weight',      'weight');
                data.addColumn('string', 'Source ID',   'source_id');              
                data.addRow(['Sophies Soup Station',       500, 'Onion']);
                data.addRow(['Pedros Pizza Palace',        250, 'Tomato']);
                data.addRow(['Carols Chocolate Compound', 5000, 'Chocolate']);
                data.addRow(['Pedros Pizza Palace',        250, 'Onion']);
                data.addRow(['Sophies Soup Station',       500, 'Tomato']);
                data.addRow(['Pedros Pizza Palace',       1000, 'Cheese']);
                data.addRow(['Pedros Pizza Palace',        250, 'Pepperoni']);
                data.addRow(['Pedros Pizza Palace',        250, 'Tuna']);
                data.addRow(['Pedros Pizza Palace',        250, 'Salami']);
                data.addRow(['Carols Chocolate Compound',  500, 'Almond']);
                data.addRow(['Carols Chocolate Compound',  500, 'Hazelnut']);
                data.addRow(['Carols Chocolate Compound',  200, 'Chili']);
                data.addRow(['Pedros Pizza Palace',        100, 'Chili']);
                data.addRow(['Sophies Soup Station',       300, 'Chili']);
                data.addRow(['Terrys Taco Tent',           500, 'Tomato']);
                data.addRow(['Terrys Taco Tent',           500, 'Chili']);
                
                var options = {canvas_size: 500, 
                               graph_radius: 200};
                
                var chart = new gchord.Chord_Diagram(document.getElementById('chart_div'));
                
                chart.fromGoogleSpreadsheet(data, options);
                chart.draw();
            }
            
            function handleQueryResponse(response) {
                if (response.isError()) {
                    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                    return;
                }
                /*
                var data = response.getDataTable();
                
                var chord_graph = new gchord.Chord_Diagram(document.getElementById('chart_div'));
                // Draw our table with the data we created locally.
                chord_graph.draw();*/
            }
            
            // Function to save the generated svg. 
            // May not work with all browsers and the generated xml
            // will be ugly/unformatted
            function show_svg_code()
            {               
                // Get the svg element
                var chart_div = document.getElementById('chart_div');
                var svgDOM    = chart_div.getElementsByTagName('svg')[0];                               
                
                var svg_xml = (new XMLSerializer).serializeToString(svgDOM);
                window.open('data:image/svg+xml;base64,'+btoa(svg_xml));
            }
            
        </script>
        <title>GChord test</title>
    </head>
    <body>
        <p>Chord graph test page</p>
        <div id="chart_div">
        </div>       
        <div id="controls_div">
            <button id="control_show_svg" value="" onclick="show_svg_code()">
                Show only SVG
            </button>
        </div>        
    </body>   
</html>